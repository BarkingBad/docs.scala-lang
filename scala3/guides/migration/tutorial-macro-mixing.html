<!DOCTYPE html>

<html class="scala3">

  <head>
    <title>
      Mixing Scala 2.13 and Scala 3 Macros | 
      Scala 3 Migration Guide | 
      Scala Documentation
    </title>
    
    <meta name="description" content="This section shows how to mix Scala 2.13 and Scala 3 macros in a single artifact" />
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:site_name" content="Scala Documentation"/>
    <meta property="og:type" content="article"/>
    <meta property="og:url" content="http://0.0.0.0:4000/scala3/guides/migration/tutorial-macro-mixing.html"/>
    <meta property="og:image" content="http://0.0.0.0:4000/resources/img/scala-spiral-3d-2-toned-down.png"/>
    <meta property="og:title" content="Mixing Scala 2.13 and Scala 3 Macros"/>
    <meta property="og:description" content="This section shows how to mix Scala 2.13 and Scala 3 macros in a single artifact"/>

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@scala_lang"/>
    <meta name="twitter:creator" content="@scala_lang"/>
    <meta name="twitter:title" content="Mixing Scala 2.13 and Scala 3 Macros"/>
    <meta name="twitter:description" content="This section shows how to mix Scala 2.13 and Scala 3 macros in a single artifact"/>

    <link rel="icon" type="image/png" href="//resources/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="//resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="//resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="//resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="//resources/favicon-16x16.png">
    <link rel="manifest" href="//resources/site.webmanifest">
    <link rel="mask-icon" href="//resources/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <meta name="theme-color" content="#ffffff">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- Custom stylesheet -->
    <link href="//resources/css/unslider-dots.css" rel="stylesheet" type="text/css">
    <link href="//resources/css/unslider.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="//resources/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="//resources/css/style.css" type="text/css" />
    <link rel="stylesheet" href="//resources/css/monospace.css" type="text/css" />

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="http://scala-lang.org/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="http://scala-lang.org/feed/blog.xml" />

    <!-- Algolia stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head>
  <body>





<div class="navigation-fade-screen"></div>



<header id="site-header">
  <div class="wrap">
    <nav class="navigation" role="menu">
      <a href="http://scala-lang.org" class="navigation-bdand">
        <img src="//resources/img/frontpage/scala-logo-white@2x.png" alt="">
      </a>
      <div class="navigation-panel-button">
        <i class="fa fa-bars"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="//" class="active">Documentation</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/download/" >Download</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/community/" >Community</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://index.scala-lang.org" >Libraries</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/contribute/" >Contribute</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/blog/" >Blog</a>
            </li>
        
      </ul>
    </nav>
  </div>
</header>



<header id="doc-header" class="scala3">

  <div class="wrap" style="padding: 0px;">
    <nav class="doc-navigation" role="menu">
      
      <div class="navigation-bdand">
      <a href="//">
        <img src="//resources/img/documentation-logo@2x.png" alt="docs">
      </a>
      <span class="doc-language-version">
        — Scala  3 
      </span>
      </div>
      <div class="navigation-ellipsis">
        <i class="fa fa-ellipsis-v"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              
              
              <a href="#" id="learn" >Learn</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    
                    
                    <a href="//scala3/new-in-scala3.html">New in Scala 3</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="//scala3/getting-started.html">Getting Started</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="//scala3/book/introduction.html">Scala 3 Book</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="//scala3/guides/macros/index.html">Macro Tutorial</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="//scala3/guides/migration/compatibility-intro.html" id="migrate" >Migrate</a>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="//scala3/reference/overview.html" id="reference" >Reference</a>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="https://dotty.epfl.ch/api/index.html" id="api" >API</a>
                
            </li>
        
      </ul>
    </nav>
    <nav class="doc-navigation-submenus">
      
        
          <ul class="navigation-submenu" id="learn" style="display: none;">
            
              <li>
                <a href="//scala3/new-in-scala3.html">New in Scala 3</a>
              </li>
            
              <li>
                <a href="//scala3/getting-started.html">Getting Started</a>
              </li>
            
              <li>
                <a href="//scala3/book/introduction.html">Scala 3 Book</a>
              </li>
            
              <li>
                <a href="//scala3/guides/macros/index.html">Macro Tutorial</a>
              </li>
            
          </ul>
        
      
        
      
        
      
        
      
      <ul class="navigation-submenu ellipsis-menu" style="display: none;">
        
          
        
          
        
          
        
          
            <li><a href="https://dotty.epfl.ch/api/index.html">API</a></li>
          
        
      </ul>
    </nav>
  </div>
</header>


<main id="inner-main">
  <!-- Title -->
  <section class="title-page">
    <div class="wrap">
      <div class="content-title-documentation">
        
          <div class="wip-notice">
            <h4>Work in Progress</h4>
            <p>
              We are still in the process of writing the documentation for Scala 3.
              You can <a  href="/scala3/contribute-to-docs.html">help us</a> to improve the documentation.
            </p>
            <p>Are you searching for the <a href="/">Scala 2 documentation</a>?</p>
          </div>
        

        <div class="titles">
          
            <div class="supertitle">Scala 3 Migration Guide</div>
          
          <h1>Mixing Scala 2.13 and Scala 3 Macros</h1>
        </div>
        <div class="language-dropdown">
          <div id="dd" class="wrapper-dropdown" tabindex="1">
            <span>Language</span>
              <ul class="dropdown"></ul>
          </div>
      </div>
    </div>
  </section>

  
  <section class="content">
	<div class="wrap">
		<div class="content-primary documentation">
			<div class="inner-box">
				<div class="toc-context">
					<p>This tutorial shows how to mix Scala 2.13 and Scala 3 macros in a single artifact.</p>

<p>It can be used to create a new Scala 3 macro library and make it available for Scala 2.13 users.
It can also be used to port an existing Scala 2.13 macro library to Scala 3, although it is probably easier to cross-build.</p>

<h2 id="introduction">Introduction</h2>

<p>The Scala 2.13 compiler can only expand Scala 2.13 macros and, conversely, the Scala 3 compiler can only expand Scala 3 macros.
The idea of mixing macros is to package both macros in a single artifact, and let the compiler choose between the two during the macro expansion phase.</p>

<p>This is only possible in Scala 3, since the Scala 3 compiler can read both the Scala 3 and the Scala 2 definitions.</p>

<p>Let’s start by considering the following code skeleton:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// example/src/main/scala/location/Location.scala</span>
<span class="k">package</span> <span class="nn">location</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Location</span><span class="o">(</span><span class="n">path</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Macros</span><span class="k">:</span>
  <span class="kt">def</span> <span class="kt">location:</span> <span class="kt">Location</span> <span class="o">=</span> <span class="n">macro</span> <span class="o">???</span>
  <span class="n">inline</span> <span class="k">def</span> <span class="nf">location</span><span class="k">:</span> <span class="kt">Location</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span> <span class="o">???</span> <span class="o">}</span>
</code></pre></div></div>

<p>As you can see the <code class="language-plaintext highlighter-rouge">location</code> macro is defined twice:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">def location: Location = macro ???</code> is a Scala 2.13 macro definition</li>
  <li><code class="language-plaintext highlighter-rouge">inline def location: Location = ${ ??? }</code> is a Scala 3 macro definition</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">location</code> is not an overloaded method, since both signatures are strictly identical.
This is quite surprising!
How does the compiler accept two methods with the same name and signature?</p>

<p>The explanation is that it recognizes the first definition is for Scala 2.13 only and the second is for Scala 3 only.</p>

<h2 id="1-implement-the-scala-3-macro">1. Implement the Scala 3 macro</h2>

<p>You can put the Scala 3 macro implementation alongside the definition.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">location</span>

<span class="k">import</span> <span class="nn">scala.quoted.</span><span class="o">{</span><span class="nc">Quotes</span><span class="o">,</span> <span class="nc">Expr</span><span class="o">}</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Location</span><span class="o">(</span><span class="n">path</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Macros</span><span class="k">:</span>
  <span class="kt">def</span> <span class="kt">location:</span> <span class="kt">Location</span> <span class="o">=</span> <span class="n">macro</span> <span class="o">???</span>
  <span class="n">inline</span> <span class="k">def</span> <span class="nf">location</span><span class="k">:</span> <span class="kt">Location</span> <span class="o">=</span> <span class="n">$</span><span class="o">{</span><span class="n">locationImpl</span><span class="o">}</span>

  <span class="k">private</span> <span class="k">def</span> <span class="nf">locationImpl</span><span class="o">(</span><span class="n">using</span> <span class="n">quotes</span><span class="k">:</span> <span class="kt">Quotes</span><span class="o">)</span><span class="k">:</span> <span class="kt">Expr</span><span class="o">[</span><span class="kt">Location</span><span class="o">]</span> <span class="k">=</span>
    <span class="k">import</span> <span class="nn">quotes.reflect.Position</span>
    <span class="k">val</span> <span class="nv">file</span> <span class="k">=</span> <span class="nc">Expr</span><span class="o">(</span><span class="nv">Position</span><span class="o">.</span><span class="py">ofMacroExpansion</span><span class="o">.</span><span class="py">sourceFile</span><span class="o">.</span><span class="py">jpath</span><span class="o">.</span><span class="py">toString</span><span class="o">)</span>
    <span class="k">val</span> <span class="nv">line</span> <span class="k">=</span> <span class="nc">Expr</span><span class="o">(</span><span class="nv">Position</span><span class="o">.</span><span class="py">ofMacroExpansion</span><span class="o">.</span><span class="py">startLine</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span>
    <span class="o">'{</span><span class="k">new</span> <span class="nc">Location</span><span class="o">(</span><span class="nc">$file</span><span class="o">,</span> <span class="nc">$line</span><span class="o">)}</span>
</code></pre></div></div>

<h2 id="2-implement-the-scala-2-macro">2. Implement the Scala 2 macro</h2>

<p>The Scala 3 compiler can compile a Scala 2 macro implementation if it contains no quasiquote or reification.</p>

<p>For instance this piece of code does compile with Scala 3, and so you can put it alongside the Scala 3 implementation.</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.reflect.macros.blackbox.Context</span>

<span class="k">def</span> <span class="nf">locationImpl</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Tree</span> <span class="o">=</span>  <span class="o">{</span>
  <span class="k">import</span> <span class="nn">c.universe._</span>
  <span class="k">val</span> <span class="nv">line</span> <span class="k">=</span> <span class="nc">Literal</span><span class="o">(</span><span class="nc">Constant</span><span class="o">(</span><span class="nv">c</span><span class="o">.</span><span class="py">enclosingPosition</span><span class="o">.</span><span class="py">line</span><span class="o">))</span>
  <span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nc">Literal</span><span class="o">(</span><span class="nc">Constant</span><span class="o">(</span><span class="nv">c</span><span class="o">.</span><span class="py">enclosingPosition</span><span class="o">.</span><span class="py">source</span><span class="o">.</span><span class="py">path</span><span class="o">))</span>
  <span class="nc">New</span><span class="o">(</span><span class="nv">c</span><span class="o">.</span><span class="py">mirror</span><span class="o">.</span><span class="py">staticClass</span><span class="o">(</span><span class="n">classOf</span><span class="o">[</span><span class="kt">Location</span><span class="o">].</span><span class="py">getName</span><span class="o">()),</span> <span class="n">path</span><span class="o">,</span> <span class="n">line</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>

<p>However, in many cases you will have to move the Scala 2.13 macro implementation in a Scala 2.13 submodule.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">example</span> <span class="k">=</span> <span class="nv">project</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nf">file</span><span class="o">(</span><span class="s">"example"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">(</span>
    <span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"3.0.0"</span>
  <span class="o">)</span>
  <span class="o">.</span><span class="py">dependsOn</span><span class="o">(</span><span class="n">`example-compat`</span><span class="o">)</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="nv">`</span><span class="n">example</span><span class="o">-</span><span class="n">compat</span><span class="o">`</span> <span class="k">=</span> <span class="nv">project</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nf">file</span><span class="o">(</span><span class="s">"example-compat"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">(</span>
    <span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.13.6"</span><span class="o">,</span>
    <span class="n">libraryDependency</span> <span class="o">+=</span> <span class="s">"org.scala-lang"</span> <span class="o">%</span> <span class="s">"scala-reflect"</span> <span class="o">%</span> <span class="nv">scalaVersion</span><span class="o">.</span><span class="py">value</span>
  <span class="o">)</span>
</code></pre></div></div>

<p>Here <code class="language-plaintext highlighter-rouge">example</code>, our main library compiled in Scala 3, depends on <code class="language-plaintext highlighter-rouge">example-compat</code> which is compiled in Scala 2.13.</p>

<p>In such a case we can put the Scala 2 macro implementation in <code class="language-plaintext highlighter-rouge">example-compat</code> and use quasiquotes.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">package</span> <span class="nn">location</span>

<span class="k">import</span> <span class="nn">scala.reflect.macros.blackbox.Context</span>
<span class="k">import</span> <span class="nn">scala.language.experimental.macros</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Location</span><span class="o">(</span><span class="n">path</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">line</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Scala2MacrosCompat</span> <span class="o">{</span>
  <span class="k">private</span><span class="o">[</span><span class="kt">location</span><span class="o">]</span> <span class="k">def</span> <span class="nf">locationImpl</span><span class="o">(</span><span class="n">c</span><span class="k">:</span> <span class="kt">Context</span><span class="o">)</span><span class="k">:</span> <span class="kt">c.Tree</span> <span class="o">=</span>  <span class="o">{</span>
    <span class="k">import</span> <span class="nn">c.universe._</span>
    <span class="k">val</span> <span class="nv">location</span> <span class="k">=</span> <span class="n">typeOf</span><span class="o">[</span><span class="kt">Location</span><span class="o">]</span>
    <span class="k">val</span> <span class="nv">line</span> <span class="k">=</span> <span class="nc">Literal</span><span class="o">(</span><span class="nc">Constant</span><span class="o">(</span><span class="nv">c</span><span class="o">.</span><span class="py">enclosingPosition</span><span class="o">.</span><span class="py">line</span><span class="o">))</span>
    <span class="k">val</span> <span class="nv">path</span> <span class="k">=</span> <span class="nc">Literal</span><span class="o">(</span><span class="nc">Constant</span><span class="o">(</span><span class="nv">c</span><span class="o">.</span><span class="py">enclosingPosition</span><span class="o">.</span><span class="py">source</span><span class="o">.</span><span class="py">path</span><span class="o">))</span>
    <span class="n">q</span><span class="s">"new $location($path, $line)"</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Note that we had to move the <code class="language-plaintext highlighter-rouge">Location</code> class downstream.</p>

<h2 id="3-cross-validate-the-macro">3. Cross-validate the macro</h2>

<p>Adding some tests is important to check that the macro method works the same in both Scala versions.</p>

<p>Since we want to execute the tests in Scala 2.13 and Scala 3, we create a cross-built module on the top:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// build.sbt</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="nv">`</span><span class="n">example</span><span class="o">-</span><span class="n">test</span><span class="o">`</span> <span class="k">=</span> <span class="nv">project</span><span class="o">.</span><span class="py">in</span><span class="o">(</span><span class="nf">file</span><span class="o">(</span><span class="s">"example-test"</span><span class="o">))</span>
  <span class="o">.</span><span class="py">settings</span><span class="o">(</span>
    <span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"3.0.0"</span><span class="o">,</span>
    <span class="n">crossScalaVersions</span> <span class="o">:=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"3.0.0"</span><span class="o">,</span> <span class="s">"2.13.6"</span><span class="o">),</span>
    <span class="n">scalacOptions</span> <span class="o">++=</span> <span class="o">{</span>
      <span class="nv">CrossVersion</span><span class="o">.</span><span class="py">partialVersion</span><span class="o">(</span><span class="nv">scalaVersion</span><span class="o">.</span><span class="py">value</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
        <span class="k">case</span> <span class="nc">Some</span><span class="o">((</span><span class="mi">2</span><span class="o">,</span> <span class="mi">13</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">"-Ytasty-reader"</span><span class="o">)</span>
        <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nv">Seq</span><span class="o">.</span><span class="py">empty</span>
      <span class="o">}</span>
    <span class="o">},</span>
    <span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"org.scalameta"</span> <span class="o">%%</span> <span class="s">"munit"</span> <span class="o">%</span> <span class="s">"0.7.26"</span> <span class="o">%</span> <span class="nc">Test</span>
  <span class="o">)</span>
  <span class="o">.</span><span class="py">dependsOn</span><span class="o">(</span><span class="n">example</span><span class="o">)</span>
</code></pre></div></div>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">-Ytasty-reader</code> is needed in Scala 2.13 to consume Scala 3 artifacts</p>
</blockquote>

<p>For instance the test can be:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// example-test/src/test/scala/location/MacrosSpec.scala</span>
<span class="k">package</span> <span class="nn">location</span>

<span class="k">class</span> <span class="nc">MacrosSpec</span> <span class="k">extends</span> <span class="nv">munit</span><span class="o">.</span><span class="py">FunSuite</span> <span class="o">{</span>
  <span class="nf">test</span><span class="o">(</span><span class="s">"location"</span><span class="o">)</span> <span class="o">{</span>
    <span class="nf">assertEquals</span><span class="o">(</span><span class="nv">Macros</span><span class="o">.</span><span class="py">location</span><span class="o">.</span><span class="py">line</span><span class="o">,</span> <span class="mi">5</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You should now be able to run the tests in both versions.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">sbt:example&gt; ++2.13.6
sbt:example&gt; example-test / test
location.MacrosSpec:
  + location
[info] Passed: Total 1, Failed 0, Errors 0, Passed 1
[success]
sbt:example&gt; ++3.0.0
sbt:example&gt; example-test / test
location.MacrosSpec:
  + location
[info] Passed: Total 1, Failed 0, Errors 0, Passed 1
[success]</code></pre></figure>

<h2 id="final-overview">Final Overview</h2>

<p>You library is now composed of:</p>
<ul>
  <li>The main Scala 3 module containing the mixed macro definitions and the Scala 3 macro implementation.</li>
  <li>The Scala 2.13 compatibility module containing the Scala 2.13 macro implementation.
It will only be consumed in Scala 2.13 during the macro expansion phase of the compiler.</li>
</ul>

<p><img src="/resources/images/scala3-migration/tutorial-macro-mixing.svg" alt="Mixing-macros Architecture" /></p>

<p>You are now ready to publish your library.</p>

<p>It can be used in Scala 3 projects, or in Scala 2.13 projects with these settings:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scalaVersion</span> <span class="o">:=</span> <span class="s">"2.13.6"</span>
<span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="o">(</span><span class="s">"org"</span> <span class="o">%%</span> <span class="s">"example"</span> <span class="o">%</span> <span class="s">"x.y.z"</span><span class="o">).</span><span class="py">cross</span><span class="o">(</span><span class="nv">CrossVersion</span><span class="o">.</span><span class="py">for2_13Use3</span><span class="o">)</span>
<span class="n">scalacOptions</span> <span class="o">+=</span> <span class="s">"-Ytasty-reader"</span>
</code></pre></div></div>

				</div>

				<div class="two-columns">
					
					<a href="tutorial-macro-mixing.html">&larr; <strong>previous</strong></a>
					
					
					<a href="tooling-syntax-rewriting.html"><strong>next</strong> &rarr;</a>
					
				</div>

				<div class="content-contributors">
    <h3>Contributors to this page:</h3>
    <div id="contributors" class="contributors-container"></div>
</div>

			</div>
		</div>

		<!-- TOC -->
		<div class="content-nav">
	<div class="inner-box sidebar-toc-wrapper" style="">
		<h5 class="contents">Contents</h5>
        
        
          <div class="inner-toc book" id="sidebar-toc">
        

      <ul>
        
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/compatibility-intro.html">Compatibility Reference</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/compatibility-source.html">Source Level</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/compatibility-classpath.html">Classpath Level</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/compatibility-runtime.html">Runtime</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/compatibility-metaprogramming.html">Metaprogramming</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/tooling-tour.html">Tour of the Migration Tools</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/tooling-migration-mode.html">Scala 3 Migration Mode</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/tutorial-intro.html">Migration Tutorial</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/tutorial-prerequisites.html">Prerequisites</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/tutorial-sbt.html">Porting an sbt Project</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/tutorial-macro-cross-building.html">Cross-Building a Macro Library</a></li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a class="active" href="//scala3/guides/migration/tutorial-macro-mixing.html">Mixing Scala 2.13 and Scala 3 Macros</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/tooling-syntax-rewriting.html">Scala 3 Syntax Rewriting</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/incompatibility-table.html">Incompatibility Table</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-syntactic.html">Syntactic Changes</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-dropped-features.html">Dropped Features</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-contextual-abstractions.html">Contextual Abstractions</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-other-changes.html">Other Changed Features</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-type-checker.html">Type Checker</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/incompat-type-inference.html">Type Inference</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/options-intro.html">Compiler Options</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/options-lookup.html">Compiler Options Lookup Table</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/options-new.html">New Compiler Options</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/scaladoc-settings-compatibility.html">Scaladoc settings compatibility between Scala2 and Scala3</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-chapter"><a  href="//scala3/guides/migration/plugin-intro.html">Compiler Plugins</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/plugin-kind-projector.html">Kind Projector Migration</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
             <!-- this must be English, so get the other documents' titles -->

               <!-- if a type is set in a document, we add it as a class. Used in Scala book to diff between chapter and section -->
                <li class="type-section"><a  href="//scala3/guides/migration/external-resources.html">External Resources</a>
						<div id="toc"></div>
						</li>
              
            
          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
					

          
        
      </ul>

      
		</div>
		<hr>
		<div class="help-us"><a href="https://github.com/scala/docs.scala-lang/blob/main/_overviews/scala3-migration/tutorial-macro-mixing.md"><i class="fa fa-pencil" aria-hidden="true"></i> Problem with this page?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please help us fix it!</a></div>
	</div>
</div>

	</div>
</section>


</main>

<footer id="site-footer">
    <div class="wrap">
      <div class="site-footer-top">
        
          <ul class="documentation">
            <li><h3>Documentation</h3></li>
            
              <li><a href="//getting-started.html">Getting Started</a></li>
            
              <li><a href="https://www.scala-lang.org/api/current/index.html">API</a></li>
            
              <li><a href="//overviews">Overviews/Guides</a></li>
            
              <li><a href="http://scala-lang.org/files/archive/spec/2.13/">Language Specification</a></li>
            
          </ul>
        
          <ul class="download">
            <li><h3>Download</h3></li>
            
              <li><a href="http://scala-lang.org/download/">Current Version</a></li>
            
              <li><a href="http://scala-lang.org/download/all.html">All versions</a></li>
            
          </ul>
        
          <ul class="community">
            <li><h3>Community</h3></li>
            
              <li><a href="http://scala-lang.org/community/">Community</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#mailing-lists">Mailing Lists</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#chat-rooms">Chat Rooms & More</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#community-libraries-and-tools">Libraries and Tools</a></li>
            
              <li><a href="http://scala.epfl.ch/">The Scala Center</a></li>
            
          </ul>
        
          <ul class="contribute">
            <li><h3>Contribute</h3></li>
            
              <li><a href="http://scala-lang.org/contribute/">How to help</a></li>
            
              <li><a href="http://scala-lang.org/contribute/bug-reporting-guide.html">Report an Issue</a></li>
            
          </ul>
        
          <ul class="scala">
            <li><h3>Scala</h3></li>
            
              <li><a href="http://scala-lang.org/blog/">Blog</a></li>
            
              <li><a href="http://scala-lang.org/conduct/">Code of Conduct</a></li>
            
              <li><a href="http://scala-lang.org/license/">License</a></li>
            
          </ul>
        
          <ul class="social">
            <li><h3>Social</h3></li>
            
              <li><a href="https://github.com/scala/scala">GitHub</a></li>
            
              <li><a href="https://twitter.com/scala_lang">Twitter</a></li>
            
          </ul>
        
      </div>
      <div class="site-footer-bottom">
        <p></p>
        <img src="//resources/img/frontpage/scala-logo-white.png" alt="">
      </div>
    </div>
    <a class="back-to-top in" href="#" id="scroll-to-top-btn">
      <i class="fa fa-angle-up"></i>
    </a>
</footer>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
<script>(window.jQuery) || document.write('<script src="//scripts/jquery-3.1.1.min.js"><\/script>');</script>
<script src="//resources/js/vendor/jquery.autocomplete.js" type="text/javascript"></script>



<script src="//scripts/searchbar.js" type="text/javascript"></script>
<link rel="stylesheet" href="//scripts/my.css" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css">

<!-- moment js -->
<script src="//resources/js/vendor/moment.min.js" type="text/javascript"></script>

<!-- tweet feed -->
<script src="//resources/js/tweetMachine-update.js" type="text/javascript"></script>

<!-- prettify js -->
<script src="//resources/js/vendor/prettify/prettify.js" type="text/javascript"></script>
<script src="//resources/js/vendor/prettify/lang-scala.js" type="text/javascript"></script>

<!-- unslider js -->
<script src="//resources/js/vendor/unslider.js" type="text/javascript"></script>

<!-- Highlight -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/languages/scala.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/languages/java.min.js" type="text/javascript"></script>

<!-- CodeMirror -->
<script src="//resources/js/vendor/codemirror/codemirror.js" type="text/javascript"></script>
<script src="//resources/js/vendor/codemirror/clike.js" type="text/javascript"></script>

<!-- TOC -->
<script src="//resources/js/vendor/toc.js" type="text/javascript"></script>

<!-- Blog search -->
<script src="//resources/js/vendor/jekyll.search.min.js" type="text/javascript"></script>

<!-- Custom JavaScript -->
<script src="//resources/js/functions.js" type="text/javascript"></script>



<!-- Alogolia search for doc -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
if ($("#doc-search-bar").length) {
  docsearch({
    apiKey: 'fbc439670f5d4e3730cdcb715c359391',
    indexName: 'scala-lang',
    inputSelector: '#doc-search-bar',
    algoliaOptions: { 'facetFilters': ["language:en"] },
    debug: false // Set debug to true if you want to inspect the dropdown
  });
}
</script>
</body>

</html>

