<!DOCTYPE html>

<html class="scala3">

  <head>
    <title>
      Erased Definitions | 
      Scala 3 Language Reference | 
      Scala Documentation
    </title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta property="og:site_name" content="Scala Documentation"/>
    <meta property="og:type" content="article"/>
    <meta property="og:url" content="http://0.0.0.0:4000/scala3/reference/experimental/erased-defs.html"/>
    <meta property="og:image" content="http://0.0.0.0:4000/resources/img/scala-spiral-3d-2-toned-down.png"/>
    <meta property="og:title" content="Erased Definitions"/>
    

    <meta name="twitter:card" content="summary"/>
    <meta name="twitter:site" content="@scala_lang"/>
    <meta name="twitter:creator" content="@scala_lang"/>
    <meta name="twitter:title" content="Erased Definitions"/>
    

    <link rel="icon" type="image/png" href="/docs.scala-lang/resources/favicon.ico">
    <link rel="shortcut icon" type="image/png" href="/docs.scala-lang/resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/docs.scala-lang/resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/docs.scala-lang/resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/docs.scala-lang/resources/favicon-16x16.png">
    <link rel="manifest" href="/docs.scala-lang/resources/site.webmanifest">
    <link rel="mask-icon" href="/docs.scala-lang/resources/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <meta name="theme-color" content="#ffffff">

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- Custom stylesheet -->
    <link href="/docs.scala-lang/resources/css/unslider-dots.css" rel="stylesheet" type="text/css">
    <link href="/docs.scala-lang/resources/css/unslider.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/highlightjs.css" type="text/css" />
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/style.css" type="text/css" />
    <link rel="stylesheet" href="/docs.scala-lang/resources/css/monospace.css" type="text/css" />

    <!-- Atom feeds -->
    <link rel="alternate" type="application/atom+xml" title="News Feed" href="http://scala-lang.org/feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Blog Feed" href="http://scala-lang.org/feed/blog.xml" />

    <!-- Algolia stylesheet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />


  </head>
  <body>





<div class="navigation-fade-screen"></div>



<header id="site-header">
  <div class="wrap">
    <nav class="navigation" role="menu">
      <a href="http://scala-lang.org" class="navigation-bdand">
        <img src="/docs.scala-lang/resources/img/frontpage/scala-logo-white@2x.png" alt="">
      </a>
      <div class="navigation-panel-button">
        <i class="fa fa-bars"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              <a href="/docs.scala-lang/" class="active">Documentation</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/download/" >Download</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/community/" >Community</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://index.scala-lang.org" >Libraries</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/contribute/" >Contribute</a>
            </li>
        
            <li class="navigation-menu-item">
              <a href="https://www.scala-lang.org/blog/" >Blog</a>
            </li>
        
      </ul>
    </nav>
  </div>
</header>



<header id="doc-header" class="scala3">

  <div class="wrap" style="padding: 0px;">
    <nav class="doc-navigation" role="menu">
      
      <div class="navigation-bdand">
      <a href="/docs.scala-lang/">
        <img src="/docs.scala-lang/resources/img/documentation-logo@2x.png" alt="docs">
      </a>
      <span class="doc-language-version">
        — Scala  3 
      </span>
      </div>
      <div class="navigation-ellipsis">
        <i class="fa fa-ellipsis-v"></i>
      </div>
      <ul class="navigation-menu">
        
            <li class="navigation-menu-item">
              
              
              <a href="#" id="learn" >Learn</a>
                
                <ul class="navigation-dropdown">
                
                  <li>
                    
                    
                    <a href="/docs.scala-lang/scala3/new-in-scala3.html">New in Scala 3</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="/docs.scala-lang/scala3/getting-started.html">Getting Started</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="/docs.scala-lang/scala3/book/introduction.html">Scala 3 Book</a>
                  </li>
                
                  <li>
                    
                    
                    <a href="/docs.scala-lang/scala3/guides/macros/index.html">Macro Tutorial</a>
                  </li>
                
                </ul>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="/docs.scala-lang/scala3/guides/migration/compatibility-intro.html" id="migrate" >Migrate</a>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="/docs.scala-lang/scala3/reference/overview.html" id="reference" >Reference</a>
                
            </li>
        
            <li class="navigation-menu-item">
              
              
              <a href="https://dotty.epfl.ch/api/index.html" id="api" >API</a>
                
            </li>
        
      </ul>
    </nav>
    <nav class="doc-navigation-submenus">
      
        
          <ul class="navigation-submenu" id="learn" style="display: none;">
            
              <li>
                <a href="/docs.scala-lang/scala3/new-in-scala3.html">New in Scala 3</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/scala3/getting-started.html">Getting Started</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/scala3/book/introduction.html">Scala 3 Book</a>
              </li>
            
              <li>
                <a href="/docs.scala-lang/scala3/guides/macros/index.html">Macro Tutorial</a>
              </li>
            
          </ul>
        
      
        
      
        
      
        
      
      <ul class="navigation-submenu ellipsis-menu" style="display: none;">
        
          
        
          
        
          
        
          
            <li><a href="https://dotty.epfl.ch/api/index.html">API</a></li>
          
        
      </ul>
    </nav>
  </div>
</header>


<main id="inner-main">
  <!-- Title -->
  <section class="title-page">
    <div class="wrap">
      <div class="content-title-documentation">
        
          <div class="wip-notice">
            <h4>Work in Progress</h4>
            <p>
              We are still in the process of writing the documentation for Scala 3.
              You can <a  href="/scala3/contribute-to-docs.html">help us</a> to improve the documentation.
            </p>
            <p>Are you searching for the <a href="/">Scala 2 documentation</a>?</p>
          </div>
        

        <div class="titles">
          
            <div class="supertitle">Scala 3 Language Reference</div>
          
          <h1>Erased Definitions</h1>
        </div>
        <div class="language-dropdown">
          <div id="dd" class="wrapper-dropdown" tabindex="1">
            <span>Language</span>
              <ul class="dropdown"></ul>
          </div>
      </div>
    </div>
  </section>

  
  <section class="content">
	<div class="wrap">
		<div class="content-primary documentation">
			<div class="inner-box">
				<div class="toc-context">
					<p><code class="language-plaintext highlighter-rouge">erased</code> is a modifier that expresses that some definition or expression is erased by the compiler instead of being represented in the compiled output. It is not yet part of the Scala language standard. To enable <code class="language-plaintext highlighter-rouge">erased</code>, turn on the language feature
<code class="language-plaintext highlighter-rouge">experimental.erasedDefinitions</code>. This can be done with a language import</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.language.experimental.erasedDefinitions</span>
</code></pre></div></div>
<p>or by setting the command line option <code class="language-plaintext highlighter-rouge">-language:experimental.erasedDefinitions</code>.</p>
<h2 id="why-erased-terms">Why erased terms?</h2>

<p>Let’s describe the motivation behind erased terms with an example. In the
following we show a simple state machine which can be in a state <code class="language-plaintext highlighter-rouge">On</code> or <code class="language-plaintext highlighter-rouge">Off</code>.
The machine can change state from <code class="language-plaintext highlighter-rouge">Off</code> to <code class="language-plaintext highlighter-rouge">On</code> with <code class="language-plaintext highlighter-rouge">turnedOn</code> only if it is
currently <code class="language-plaintext highlighter-rouge">Off</code>. This last constraint is captured with the <code class="language-plaintext highlighter-rouge">IsOff[S]</code> contextual
evidence which only exists for <code class="language-plaintext highlighter-rouge">IsOff[Off]</code>. For example, not allowing calling
<code class="language-plaintext highlighter-rouge">turnedOn</code> on in an <code class="language-plaintext highlighter-rouge">On</code> state as we would require an evidence of type
<code class="language-plaintext highlighter-rouge">IsOff[On]</code> that will not be found.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">On</span> <span class="k">extends</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Off</span> <span class="k">extends</span> <span class="nc">State</span>

<span class="nd">@implicitNotFound</span><span class="o">(</span><span class="s">"State must be Off"</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span>
<span class="nc">object</span> <span class="nc">IsOff</span><span class="k">:</span>
  <span class="kt">given</span> <span class="kt">isOff:</span> <span class="kt">IsOff</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>

<span class="k">class</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span><span class="nc">:</span>
  <span class="k">def</span> <span class="nf">turnedOn</span><span class="o">(</span><span class="n">using</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">S</span><span class="o">])</span><span class="k">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span>

<span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>
<span class="nv">m</span><span class="o">.</span><span class="py">turnedOn</span>
<span class="nv">m</span><span class="o">.</span><span class="py">turnedOn</span><span class="o">.</span><span class="py">turnedOn</span> <span class="c1">// ERROR</span>
<span class="c1">//                 ^</span>
<span class="c1">//                  State must be Off</span>
</code></pre></div></div>

<p>Note that in the code above the actual context arguments for <code class="language-plaintext highlighter-rouge">IsOff</code> are never
used at runtime; they serve only to establish the right constraints at compile
time. As these terms are never used at runtime there is not real need to have
them around, but they still need to be present in some form in the generated
code to be able to do separate compilation and retain binary compatibility. We
introduce <em>erased terms</em> to overcome this limitation: we are able to enforce the
right constrains on terms at compile time. These terms have no run time
semantics and they are completely erased.</p>

<h2 id="how-to-define-erased-terms">How to define erased terms?</h2>

<p>Parameters of methods and functions can be declared as erased, placing <code class="language-plaintext highlighter-rouge">erased</code>
in front of a parameter list (like <code class="language-plaintext highlighter-rouge">given</code>).</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">methodWithErasedEv</span><span class="o">(</span><span class="n">erased</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Ev</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">42</span>

<span class="k">val</span> <span class="nv">lambdaWithErasedEv</span><span class="k">:</span> <span class="kt">erased</span> <span class="kt">Ev</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span>
  <span class="o">(</span><span class="n">erased</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Ev</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">42</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">erased</code> parameters will not be usable for computations, though they can be used
as arguments to other <code class="language-plaintext highlighter-rouge">erased</code> parameters.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">methodWithErasedInt1</span><span class="o">(</span><span class="n">erased</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="n">i</span> <span class="o">+</span> <span class="mi">42</span> <span class="c1">// ERROR: can not use i</span>

<span class="k">def</span> <span class="nf">methodWithErasedInt2</span><span class="o">(</span><span class="n">erased</span> <span class="n">i</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="nf">methodWithErasedInt1</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="c1">// OK</span>
</code></pre></div></div>

<p>Not only parameters can be marked as erased, <code class="language-plaintext highlighter-rouge">val</code> and <code class="language-plaintext highlighter-rouge">def</code> can also be marked
with <code class="language-plaintext highlighter-rouge">erased</code>. These will also only be usable as arguments to <code class="language-plaintext highlighter-rouge">erased</code>
parameters.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erased</span> <span class="k">val</span> <span class="nv">erasedEvidence</span><span class="k">:</span> <span class="kt">Ev</span> <span class="o">=</span> <span class="o">...</span>
<span class="nf">methodWithErasedEv</span><span class="o">(</span><span class="n">erasedEvidence</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="what-happens-with-erased-values-at-runtime">What happens with erased values at runtime?</h2>

<p>As <code class="language-plaintext highlighter-rouge">erased</code> are guaranteed not to be used in computations, they can and will be
erased.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// becomes def methodWithErasedEv(): Int at runtime</span>
<span class="k">def</span> <span class="nf">methodWithErasedEv</span><span class="o">(</span><span class="n">erased</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Ev</span><span class="o">)</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="o">...</span>

<span class="k">def</span> <span class="nf">evidence1</span><span class="k">:</span> <span class="kt">Ev</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">erased</span> <span class="k">def</span> <span class="nf">erasedEvidence2</span><span class="k">:</span> <span class="kt">Ev</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// does not exist at runtime</span>
<span class="n">erased</span> <span class="k">val</span> <span class="nv">erasedEvidence3</span><span class="k">:</span> <span class="kt">Ev</span> <span class="o">=</span> <span class="o">...</span> <span class="c1">// does not exist at runtime</span>

<span class="c1">// evidence1 is not evaluated and no value is passed to methodWithErasedEv</span>
<span class="nf">methodWithErasedEv</span><span class="o">(</span><span class="n">evidence1</span><span class="o">)</span>
</code></pre></div></div>

<h2 id="state-machine-with-erased-evidence-example">State machine with erased evidence example</h2>

<p>The following example is an extended implementation of a simple state machine
which can be in a state <code class="language-plaintext highlighter-rouge">On</code> or <code class="language-plaintext highlighter-rouge">Off</code>. The machine can change state from <code class="language-plaintext highlighter-rouge">Off</code>
to <code class="language-plaintext highlighter-rouge">On</code> with <code class="language-plaintext highlighter-rouge">turnedOn</code> only if it is currently <code class="language-plaintext highlighter-rouge">Off</code>, conversely from <code class="language-plaintext highlighter-rouge">On</code> to
<code class="language-plaintext highlighter-rouge">Off</code> with <code class="language-plaintext highlighter-rouge">turnedOff</code> only if it is currently <code class="language-plaintext highlighter-rouge">On</code>. These last constraint are
captured with the <code class="language-plaintext highlighter-rouge">IsOff[S]</code> and <code class="language-plaintext highlighter-rouge">IsOn[S]</code> given evidence only exist for
<code class="language-plaintext highlighter-rouge">IsOff[Off]</code> and <code class="language-plaintext highlighter-rouge">IsOn[On]</code>. For example, not allowing calling <code class="language-plaintext highlighter-rouge">turnedOff</code> on in
an <code class="language-plaintext highlighter-rouge">Off</code> state as we would require an evidence <code class="language-plaintext highlighter-rouge">IsOn[Off]</code> that will not be
found.</p>

<p>As the given evidences of <code class="language-plaintext highlighter-rouge">turnedOn</code> and <code class="language-plaintext highlighter-rouge">turnedOff</code> are not used in the
bodies of those functions we can mark them as <code class="language-plaintext highlighter-rouge">erased</code>. This will remove the
evidence parameters at runtime, but we would still evaluate the <code class="language-plaintext highlighter-rouge">isOn</code> and
<code class="language-plaintext highlighter-rouge">isOff</code> givens that were found as arguments. As <code class="language-plaintext highlighter-rouge">isOn</code> and <code class="language-plaintext highlighter-rouge">isOff</code> are not
used except as <code class="language-plaintext highlighter-rouge">erased</code> arguments, we can mark them as <code class="language-plaintext highlighter-rouge">erased</code>, hence removing
the evaluation of the <code class="language-plaintext highlighter-rouge">isOn</code> and <code class="language-plaintext highlighter-rouge">isOff</code> evidences.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.annotation.implicitNotFound</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">On</span> <span class="k">extends</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Off</span> <span class="k">extends</span> <span class="nc">State</span>

<span class="nd">@implicitNotFound</span><span class="o">(</span><span class="s">"State must be Off"</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span>
<span class="nc">object</span> <span class="nc">IsOff</span><span class="k">:</span>
  <span class="c1">// will not be called at runtime for turnedOn, the</span>
  <span class="c1">// compiler will only require that this evidence exists</span>
  <span class="n">given</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IsOff</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>

<span class="nd">@implicitNotFound</span><span class="o">(</span><span class="s">"State must be On"</span><span class="o">)</span>
<span class="k">class</span> <span class="nc">IsOn</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span>
<span class="nc">object</span> <span class="nc">IsOn</span><span class="k">:</span>
  <span class="c1">// will not exist at runtime, the compiler will only</span>
  <span class="c1">// require that this evidence exists at compile time</span>
  <span class="n">erased</span> <span class="n">given</span> <span class="nc">IsOn</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">IsOn</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span>

<span class="k">class</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span> <span class="nc">private</span> <span class="o">()</span><span class="k">:</span>
  <span class="c1">// ev will disappear from both functions</span>
  <span class="k">def</span> <span class="nf">turnedOn</span><span class="o">(</span><span class="n">using</span> <span class="n">erased</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">IsOff</span><span class="o">[</span><span class="kt">S</span><span class="o">])</span><span class="k">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span>
  <span class="k">def</span> <span class="nf">turnedOff</span><span class="o">(</span><span class="n">using</span> <span class="n">erased</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">IsOn</span><span class="o">[</span><span class="kt">S</span><span class="o">])</span><span class="k">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>

<span class="k">object</span> <span class="nc">Machine</span><span class="k">:</span>
  <span class="kt">def</span> <span class="kt">newMachine</span><span class="o">()</span><span class="kt">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>

<span class="nd">@main</span> <span class="k">def</span> <span class="nf">test</span> <span class="k">=</span>
  <span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nv">Machine</span><span class="o">.</span><span class="py">newMachine</span><span class="o">()</span>
  <span class="nv">m</span><span class="o">.</span><span class="py">turnedOn</span>
  <span class="nv">m</span><span class="o">.</span><span class="py">turnedOn</span><span class="o">.</span><span class="py">turnedOff</span>

  <span class="c1">// m.turnedOff</span>
  <span class="c1">//            ^</span>
  <span class="c1">//            State must be On</span>

  <span class="c1">// m.turnedOn.turnedOn</span>
  <span class="c1">//                    ^</span>
  <span class="c1">//                    State must be Off</span>
</code></pre></div></div>

<p>Note that in <a href="../metaprogramming/inline.html">Inline</a> we discussed <code class="language-plaintext highlighter-rouge">erasedValue</code> and inline
matches. <code class="language-plaintext highlighter-rouge">erasedValue</code> is implemented with <code class="language-plaintext highlighter-rouge">erased</code>, so the state machine above
can be encoded as follows:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">scala.compiletime.</span><span class="o">*</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">On</span> <span class="k">extends</span> <span class="nc">State</span>
<span class="k">final</span> <span class="k">class</span> <span class="nc">Off</span> <span class="k">extends</span> <span class="nc">State</span>

<span class="k">class</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">S</span> <span class="k">&lt;:</span> <span class="kt">State</span><span class="o">]</span><span class="nc">:</span>
  <span class="n">transparent</span> <span class="n">inline</span> <span class="k">def</span> <span class="nf">turnOn</span><span class="o">()</span><span class="k">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">inline</span> <span class="n">erasedValue</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="k">match</span>
      <span class="k">case</span> <span class="k">_:</span> <span class="kt">Off</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">On</span><span class="o">]</span>
      <span class="k">case</span> <span class="k">_:</span> <span class="kt">On</span>  <span class="o">=&gt;</span> <span class="nf">error</span><span class="o">(</span><span class="s">"Turning on an already turned on machine"</span><span class="o">)</span>

  <span class="n">transparent</span> <span class="n">inline</span> <span class="k">def</span> <span class="nf">turnOff</span><span class="o">()</span><span class="k">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span>
    <span class="n">inline</span> <span class="n">erasedValue</span><span class="o">[</span><span class="kt">S</span><span class="o">]</span> <span class="k">match</span>
      <span class="k">case</span> <span class="k">_:</span> <span class="kt">On</span>  <span class="o">=&gt;</span> <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>
      <span class="k">case</span> <span class="k">_:</span> <span class="kt">Off</span> <span class="o">=&gt;</span> <span class="nf">error</span><span class="o">(</span><span class="s">"Turning off an already turned off machine"</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Machine</span><span class="k">:</span>
  <span class="kt">def</span> <span class="kt">newMachine</span><span class="o">()</span><span class="kt">:</span> <span class="kt">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span> <span class="k">=</span>
    <span class="nf">println</span><span class="o">(</span><span class="s">"newMachine"</span><span class="o">)</span>
    <span class="k">new</span> <span class="nc">Machine</span><span class="o">[</span><span class="kt">Off</span><span class="o">]</span>
<span class="n">end</span> <span class="nc">Machine</span>

<span class="nd">@main</span> <span class="k">def</span> <span class="nf">test</span> <span class="k">=</span>
  <span class="k">val</span> <span class="nv">m</span> <span class="k">=</span> <span class="nv">Machine</span><span class="o">.</span><span class="py">newMachine</span><span class="o">()</span>
  <span class="nv">m</span><span class="o">.</span><span class="py">turnOn</span><span class="o">()</span>
  <span class="nv">m</span><span class="o">.</span><span class="py">turnOn</span><span class="o">().</span><span class="py">turnOff</span><span class="o">()</span>
  <span class="nv">m</span><span class="o">.</span><span class="py">turnOn</span><span class="o">().</span><span class="py">turnOn</span><span class="o">()</span> <span class="c1">// error: Turning on an already turned on machine</span>
</code></pre></div></div>

<h2 id="erased-classes">Erased Classes</h2>

<p><code class="language-plaintext highlighter-rouge">erased</code> can also be used as a modifier for a class. An erased class is intended to be used only in erased definitions. If the type of a val definition or parameter is
a (possibly aliased, refined, or instantiated) erased class, the definition is assumed to be <code class="language-plaintext highlighter-rouge">erased</code> itself. Likewise, a method with an erased class return type is assumed to be <code class="language-plaintext highlighter-rouge">erased</code> itself. Since given instances expand to vals and defs, they are also assumed to be erased if the type they produce is an erased class. Finally
function types with erased classes as arguments turn into erased function types.</p>

<p>Example:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erased</span> <span class="k">class</span> <span class="nc">CanRead</span>

<span class="k">val</span> <span class="nv">x</span><span class="k">:</span> <span class="kt">CanRead</span> <span class="o">=</span> <span class="o">...</span>        <span class="c1">// `x` is turned into an erased val</span>
<span class="k">val</span> <span class="nv">y</span><span class="k">:</span> <span class="kt">CanRead</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">...</span> <span class="c1">// the function is turned into an erased function</span>
<span class="k">def</span> <span class="nf">f</span><span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">CanRead</span><span class="o">)</span> <span class="k">=</span> <span class="o">...</span>     <span class="c1">// `f` takes an erased parameter</span>
<span class="k">def</span> <span class="nf">g</span><span class="o">()</span><span class="k">:</span> <span class="kt">CanRead</span> <span class="o">=</span> <span class="o">...</span>      <span class="c1">// `g` is turned into an erased def</span>
<span class="n">given</span> <span class="nc">CanRead</span> <span class="k">=</span> <span class="o">...</span>         <span class="c1">// the anonymous given is assumed to be erased</span>
</code></pre></div></div>
<p>The code above expands to</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">erased</span> <span class="k">class</span> <span class="nc">CanRead</span>

<span class="n">erased</span> <span class="k">val</span> <span class="nv">x</span><span class="k">:</span> <span class="kt">CanRead</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">val</span> <span class="nv">y</span><span class="k">:</span> <span class="o">(</span><span class="kt">erased</span> <span class="kt">CanRead</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">...</span>
<span class="k">def</span> <span class="nf">f</span><span class="o">(</span><span class="n">erased</span> <span class="n">x</span><span class="k">:</span> <span class="kt">CanRead</span><span class="o">)</span> <span class="k">=</span> <span class="o">...</span>
<span class="n">erased</span> <span class="k">def</span> <span class="nf">g</span><span class="o">()</span><span class="k">:</span> <span class="kt">CanRead</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">erased</span> <span class="n">given</span> <span class="nc">CanRead</span> <span class="k">=</span> <span class="o">...</span>
</code></pre></div></div>
<p>After erasure, it is checked that no references to values of erased classes remain and that no instances of erased classes are created. So the following would be an error:</p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="nv">err</span><span class="k">:</span> <span class="kt">Any</span> <span class="o">=</span> <span class="nc">CanRead</span><span class="o">()</span> <span class="c1">// error: illegal reference to erased class CanRead</span>
</code></pre></div></div>
<p>Here, the type of <code class="language-plaintext highlighter-rouge">err</code> is <code class="language-plaintext highlighter-rouge">Any</code>, so <code class="language-plaintext highlighter-rouge">err</code> is not considered erased. Yet its initializing value is a reference to the erased class <code class="language-plaintext highlighter-rouge">CanRead</code>.</p>

<p><a href="./erased-defs-spec.html">More Details</a></p>

				</div>

				<div class="content-contributors">
    <h3>Contributors to this page:</h3>
    <div id="contributors" class="contributors-container"></div>
</div>

			</div>
		</div>

		<!-- TOC -->
		<div class="content-nav">
	<div class="inner-box sidebar-toc-wrapper" style="">
		<h5 class="contents">Contents</h5>
		<div class="inner-toc" id="sidebar-toc">
      <div id="toc"></div>
      
		</div>
		<hr>
		<div class="help-us"><a href="https://github.com/scala/docs.scala-lang/blob/main/_scala3-reference/experimental/erased-defs.md"><i class="fa fa-pencil" aria-hidden="true"></i> Problem with this page?<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Please help us fix it!</a></div>
	</div>
</div>

	</div>
</section>


</main>

<footer id="site-footer">
    <div class="wrap">
      <div class="site-footer-top">
        
          <ul class="documentation">
            <li><h3>Documentation</h3></li>
            
              <li><a href="/docs.scala-lang/getting-started.html">Getting Started</a></li>
            
              <li><a href="https://www.scala-lang.org/api/current/index.html">API</a></li>
            
              <li><a href="/docs.scala-lang/overviews">Overviews/Guides</a></li>
            
              <li><a href="http://scala-lang.org/files/archive/spec/2.13/">Language Specification</a></li>
            
          </ul>
        
          <ul class="download">
            <li><h3>Download</h3></li>
            
              <li><a href="http://scala-lang.org/download/">Current Version</a></li>
            
              <li><a href="http://scala-lang.org/download/all.html">All versions</a></li>
            
          </ul>
        
          <ul class="community">
            <li><h3>Community</h3></li>
            
              <li><a href="http://scala-lang.org/community/">Community</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#mailing-lists">Mailing Lists</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#chat-rooms">Chat Rooms & More</a></li>
            
              <li><a href="http://scala-lang.org/community/index.html#community-libraries-and-tools">Libraries and Tools</a></li>
            
              <li><a href="http://scala.epfl.ch/">The Scala Center</a></li>
            
          </ul>
        
          <ul class="contribute">
            <li><h3>Contribute</h3></li>
            
              <li><a href="http://scala-lang.org/contribute/">How to help</a></li>
            
              <li><a href="http://scala-lang.org/contribute/bug-reporting-guide.html">Report an Issue</a></li>
            
          </ul>
        
          <ul class="scala">
            <li><h3>Scala</h3></li>
            
              <li><a href="http://scala-lang.org/blog/">Blog</a></li>
            
              <li><a href="http://scala-lang.org/conduct/">Code of Conduct</a></li>
            
              <li><a href="http://scala-lang.org/license/">License</a></li>
            
          </ul>
        
          <ul class="social">
            <li><h3>Social</h3></li>
            
              <li><a href="https://github.com/scala/scala">GitHub</a></li>
            
              <li><a href="https://twitter.com/scala_lang">Twitter</a></li>
            
          </ul>
        
      </div>
      <div class="site-footer-bottom">
        <p></p>
        <img src="/docs.scala-lang/resources/img/frontpage/scala-logo-white.png" alt="">
      </div>
    </div>
    <a class="back-to-top in" href="#" id="scroll-to-top-btn">
      <i class="fa fa-angle-up"></i>
    </a>
</footer>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7" crossorigin="anonymous"></script>
<script>(window.jQuery) || document.write('<script src="/docs.scala-lang/scripts/jquery-3.1.1.min.js"><\/script>');</script>
<script src="/docs.scala-lang/resources/js/vendor/jquery.autocomplete.js" type="text/javascript"></script>



<script src="/docs.scala-lang/scripts/searchbar.js" type="text/javascript"></script>
<link rel="stylesheet" href="/docs.scala-lang/scripts/my.css" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/all.min.css">

<!-- moment js -->
<script src="/docs.scala-lang/resources/js/vendor/moment.min.js" type="text/javascript"></script>

<!-- tweet feed -->
<script src="/docs.scala-lang/resources/js/tweetMachine-update.js" type="text/javascript"></script>

<!-- prettify js -->
<script src="/docs.scala-lang/resources/js/vendor/prettify/prettify.js" type="text/javascript"></script>
<script src="/docs.scala-lang/resources/js/vendor/prettify/lang-scala.js" type="text/javascript"></script>

<!-- unslider js -->
<script src="/docs.scala-lang/resources/js/vendor/unslider.js" type="text/javascript"></script>

<!-- Highlight -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/languages/scala.min.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/languages/java.min.js" type="text/javascript"></script>

<!-- CodeMirror -->
<script src="/docs.scala-lang/resources/js/vendor/codemirror/codemirror.js" type="text/javascript"></script>
<script src="/docs.scala-lang/resources/js/vendor/codemirror/clike.js" type="text/javascript"></script>

<!-- TOC -->
<script src="/docs.scala-lang/resources/js/vendor/toc.js" type="text/javascript"></script>

<!-- Blog search -->
<script src="/docs.scala-lang/resources/js/vendor/jekyll.search.min.js" type="text/javascript"></script>

<!-- Custom JavaScript -->
<script src="/docs.scala-lang/resources/js/functions.js" type="text/javascript"></script>



<!-- Alogolia search for doc -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
if ($("#doc-search-bar").length) {
  docsearch({
    apiKey: 'fbc439670f5d4e3730cdcb715c359391',
    indexName: 'scala-lang',
    inputSelector: '#doc-search-bar',
    algoliaOptions: { 'facetFilters': ["language:en"] },
    debug: false // Set debug to true if you want to inspect the dropdown
  });
}
</script>
</body>

</html>

